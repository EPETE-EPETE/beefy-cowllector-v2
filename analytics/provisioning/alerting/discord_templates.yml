apiVersion: 1

templates:
  - orgID: 1
    name: discord.title
    template: |-2
      {{ define "discord.title" }}
      {{ len .Alerts.Firing }} firing alert(s), {{ len .Alerts.Resolved }} resolved alert(s)
      {{ end }}
  - orgID: 1
    name: beefy.alert.action_urls
    template: |-2
      {{- if .SilenceURL -}}[Silence]({{ .SilenceURL }}){{ end }} | {{ if .DashboardURL -}}[Dashboard]({{ .DashboardURL }}){{ end -}}
  - orgID: 1
    name: beefy.alert.status
    template: >
      {{- if eq .Status "firing" }}ðŸ”¥{{ end }}{{ if eq .Status "resolved" }}âœ…{{ end }} {{.Status -}}
  - orgID: 1
    name: discord.message
    template: |-2
      {{- $template := "default" -}}
      {{- range .Alerts -}}
        {{- $template = index .Labels "template" -}}
        {{- break -}}
      {{- end -}}
      {{- if eq $template "alert_vault_harvest_in_error" -}}
      ### Vault Harvest: {{ len .Alerts.Firing }} firing alert(s), {{ len .Alerts.Resolved }} resolved alert(s)
      {{   range .Alerts -}}
      - {{ template "beefy.alert.status" . }}: [{{ index .Labels "vault_id" }}](<https://app.beefy.finance/vault/{{index .Labels "vault_id"}}>)
      {{   end }}
      <@&__DISCORD_PING_ROLE_ID_ON_ERROR__>: {{with $a := index .Alerts 0}}{{ template "beefy.alert.action_urls" $a }}{{end}}
      {{- else -}}
      ### {{ len .Alerts.Firing }} firing alert(s), {{ len .Alerts.Resolved }} resolved alert(s):
      {{   range .Alerts -}}
      {{-    template "beefy.alert.status" . }} {{ .Labels.alertname }} <@&__DISCORD_PING_ROLE_ID_ON_ERROR__>: {{ template "beefy.alert.action_urls" . }}
      {{     range .Labels.SortedPairs -}}
      - {{ .Name }}: {{ .Value }}
      {{     end -}}
      {{     if .Annotations -}}
      {{       range .Annotations.SortedPairs -}}
      - {{ .Name }}: {{ .Value }}
      {{       end -}}
      {{     end }}
      {{   end -}}
      {{- end -}}

